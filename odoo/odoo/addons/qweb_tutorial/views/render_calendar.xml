<odoo>
  <template id="travel_event_calendar" name="Travel Website Calendar">
    <t t-call="website.layout">
      <div class="container">
        <h2>Travel Booking Calendar</h2>
        <div id="calendar"></div>
      </div>

     <!-- Appointment Modal -->
      <div class="modal fade" id="appointmentModal" tabindex="-1">
        <div class="modal-dialog">
          <div class="modal-content">
            <form id="appointmentForm">
              <div class="modal-header">
                <h5 class="modal-title">Create Appointment</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
              </div>
              <div class="modal-body">
                <div class="mb-3">
                  <label for="apptTitle" class="form-label">Title</label>
                  <input type="text" class="form-control" id="apptTitle" required="required"/>
                </div>
                <input type="hidden" id="apptStart"/>
                <input type="hidden" id="apptEnd"/>
              </div>
              <div class="modal-footer">
                <button type="submit" class="btn btn-primary">Save</button>
              </div>
            </form>
          </div>
        </div>
      </div>

      <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/main.min.css" rel="stylesheet"/>
      <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
      <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

      <script type="text/javascript">
        document.addEventListener('DOMContentLoaded', function () {
          const calendarEl = document.getElementById('calendar');
          const calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'dayGridMonth',
            selectable: true,
            headerToolbar: {
              left: 'prev,next today',
              center: 'title',
              right: 'dayGridMonth,timeGridWeek,timeGridDay'
            },
            events: [
              <t t-foreach="events" t-as="ev">
                {
                  title: "<t t-esc='ev.name'/>",
                  start: "<t t-esc='ev.start_date.isoformat()'/>",
                  end: "<t t-esc='ev.end_date.isoformat()'/>"
                }<t t-if="not loop.last">,</t>
              </t>
            ],
            dateClick: function(info) {
              const start = info.dateStr + 'T09:00:00';
              const end = info.dateStr + 'T10:00:00';
              document.getElementById('apptStart').value = start;
              document.getElementById('apptEnd').value = end;
              new bootstrap.Modal(document.getElementById('appointmentModal')).show();
            }
          });

          calendar.render();

          document.getElementById('appointmentForm').addEventListener('submit', function (e) {
            e.preventDefault();
            const title = document.getElementById('apptTitle').value;
            const start = document.getElementById('apptStart').value;
            const end = document.getElementById('apptEnd').value;

            fetch('/appointments/create', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ title, start, end })
            }).then(res => res.json())
              .then(data => {
                if (data.success) {
                  calendar.addEvent({ title, start, end });
                  bootstrap.Modal.getInstance(document.getElementById('appointmentModal')).hide();
                  document.getElementById('appointmentForm').reset();
                } else {
                  alert('Failed to create appointment');
                }
              });
          });
        });
      </script>
    </t>
  </template>
</odoo>
